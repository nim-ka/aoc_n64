#include <ultra64.h>

#include "config.h"
#include "buffers/framebuffers.h"
#include "game_init.h"

/*
	{
		0x00000000,
		0x00000000,
		0x00000000,
		0x00000000,
		0x00000000,
		0x00000000,
		0x00000000,
		0x00000000
	},
*/

u32 sGlyphs[][8] = {
	{
		0x01110000,
		0x10001000,
		0x10001000,
		0x10001000,
		0x10001000,
		0x10001000,
		0x10001000,
		0x01110000
	},
	{
		0x11100000,
		0x00100000,
		0x00100000,
		0x00100000,
		0x00100000,
		0x00100000,
		0x00100000,
		0x11111000
	},
	{
		0x01110000,
		0x10001000,
		0x00001000,
		0x00001000,
		0x00010000,
		0x00100000,
		0x01000000,
		0x11111000
	},
	{
		0x01110000,
		0x10001000,
		0x00001000,
		0x01110000,
		0x00001000,
		0x00001000,
		0x10001000,
		0x01110000
	},
	{
		0x00001000,
		0x00011000,
		0x00101000,
		0x01001000,
		0x11111100,
		0x00001000,
		0x00001000,
		0x00001000
	},
	{
		0x11111000,
		0x10000000,
		0x10000000,
		0x11110000,
		0x00001000,
		0x00001000,
		0x10001000,
		0x01110000
	},
	{
		0x01110000,
		0x10001000,
		0x10000000,
		0x10000000,
		0x11110000,
		0x10001000,
		0x10001000,
		0x01110000
	},
	{
		0x11111000,
		0x00001000,
		0x00001000,
		0x00001000,
		0x00010000,
		0x00100000,
		0x01000000,
		0x10000000
	},
	{
		0x01110000,
		0x10001000,
		0x10001000,
		0x01110000,
		0x10001000,
		0x10001000,
		0x10001000,
		0x01110000
	},
	{
		0x01110000,
		0x10001000,
		0x10001000,
		0x10001000,
		0x01111000,
		0x00001000,
		0x10001000,
		0x01110000
	}
};

void fb_print_str(int x, int y, const char *str) {
	int pos = 0;

	for (; *str; str++, pos++) {
		u32 *glyph = NULL;

		if (*str >= '0' && *str <= '9') {
			glyph = sGlyphs[*str - '0'];
		}

		if (glyph) {
			int i, j;
			u16 *fb = (u16 *) (gPhysicalFrameBuffers[(frameBufferIndex + 2) % 3] | 0x80000000);

			gFrameBuffer0[200 * SCREEN_WIDTH + 100] = 0xFFFF;
			gFrameBuffer1[200 * SCREEN_WIDTH + 100] = 0xFFFF;
			gFrameBuffer2[200 * SCREEN_WIDTH + 100] = 0xFFFF;

			for (i = 0; i < 8; i++) {
				for (j = 0; j < 8; j++) {
					fb[(x + i + 8*pos) + (y + j) * SCREEN_WIDTH] = (glyph[j] & (0x1 << ((7 - i) * 4))) ? 0xFFFF : 0x0000;
				}
			}
		}
	}
}
